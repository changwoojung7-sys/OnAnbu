# � ON-ANBU 개발 지침서

> **이 문서는 AI 어시스턴트(Antigravity)가 프로젝트를 로드할 때 자동으로 참조하는 프로젝트 컨텍스트 문서입니다.**
> 프로젝트의 정체성, 기술 스택, 아키텍처, 핵심 규칙을 정의합니다.

---

## 1. 프로젝트 정체성 (Project Identity)

| 항목 | 내용 |
|------|------|
| **앱 이름** | **ON-ANBU (온안부)** |
| **패키지명** | `com.onanbu.app` |
| **슬로건** | "부모님과 자녀를 연결하는 따뜻한 안부 서비스" |
| **핵심 가치** | Zero UI 철학 · 따뜻한 감성 · 직관적 UX |
| **타겟 유저** | 부모님(Parent) + 자녀/보호자(Guardian) |
| **수익 모델** | 광고 시청을 "효도 선물"로 리프레이밍 (광고→케어 행위) |

### 기획 컨셉

- **부모님**: 스마트폰 조작이 어려운 부모님이 버튼 하나로 안부를 전송
- **자녀**: 부모님의 하루 일과와 안부를 실시간으로 확인하고, 가족과 케어 역할 분담
- **감성 UX**: 불안감 조성 금지, 실패 경험 숨기기, 성공 경험만 강조

---

## 2. 기술 스택 (Tech Stack)

| 영역 | 기술 |
|------|------|
| **Framework** | React Native (Expo SDK 52) |
| **Language** | TypeScript |
| **Navigation** | Expo Router (파일 시스템 기반) |
| **Backend/DB** | Supabase (PostgreSQL, Auth, Storage, Realtime) |
| **State** | Zustand (`authStore`, `actionStore`) |
| **Styling** | `StyleSheet` + Design Tokens (`Colors.ts`, `theme.ts`) |
| **Animation** | React Native Reanimated |
| **Media** | expo-image-picker, expo-av (비디오 인라인 플레이어) |
| **Ads** | react-native-google-mobile-ads (보상형 광고 무제한 송출) |
| **Deployment** | **Cloudflare Pages** (SPA `single` 빌드, `_redirects` 라우팅 지원) |
| **Build** | Metro Bundler, Native Expo Prebuild |

---

## 3. 디렉토리 구조 (Directory Structure)

```
onanbu-app/
├── app/                    # Expo Router 페이지 (스크린)
│   ├── (tabs)/             # 자녀용 하단 탭 네비게이션
│   │   ├── index.tsx       # 홈 (안부 상태 확인)
│   │   ├── care.tsx        # 케어 액션 (광고→선물)
│   │   └── two.tsx         # 히스토리
│   ├── auth/               # 인증 관련 화면
│   │   ├── login.tsx       # 로그인
│   │   ├── signup.tsx      # 회원가입
│   │   ├── role-select.tsx # 역할 선택 (guardian/parent)
│   │   ├── enter-code.tsx  # 초대 코드 입력
│   │   └── parent-signup.tsx # 부모님 전용 가입
│   ├── parent/             # 부모님 전용 화면
│   ├── family/             # 가족 관리
│   ├── admin/              # 관리자 화면
│   ├── profile/            # 프로필
│   ├── settings.tsx        # 설정
│   └── notifications.tsx   # 알림
├── components/             # 재사용 UI 컴포넌트
│   ├── home/               # 홈 화면 전용 컴포넌트
│   └── care/               # 케어 화면 전용 컴포넌트
├── constants/              # 디자인 토큰 & 문자열 상수
│   ├── Colors.ts           # 컬러 팔레트
│   ├── theme.ts            # 테마 토큰
│   └── strings.ts          # UI 문구 상수
├── lib/                    # 유틸리티 & 외부 서비스
│   ├── supabase.ts         # Supabase 클라이언트
│   ├── notificationService.ts # 알림 서비스 (Realtime + Web Notifications)
│   └── types.ts            # TypeScript 타입 정의
├── stores/                 # 전역 상태 관리 (Zustand)
│   ├── authStore.ts        # 인증 상태
│   └── actionStore.ts      # 액션/활동 상태
├── supabase/               # DB 마이그레이션 & SQL
│   └── migrations/
├── zmd/                    # 프로젝트 문서
│   ├── 개발 지침서.md      # ← 이 문서
│   ├── Context.md          # 상세 구현 현황
│   └── Supabase 정보.md    # DB 접속 정보
└── assets/                 # 이미지, 아이콘
```

---

## 4. 사용자 역할 & 화면 구성

### 👴 부모님 (Parent) - `app/parent/`

- 초간단 안부 전송 (버튼 하나로 "일어났어요", "약 먹었어요")
- 사진/동영상/음성 메시지 전송
- 기분 체크 (이모지 선택)
- **개인 프로필 설정**: 이름 및 프로필 사진 등록/수정 가능

### 👩‍👧 자녀/보호자 (Guardian) - `app/(tabs)/`

- **HOME** (`index.tsx`): 부모님 안부 상태 카드 (완료/미완료 판단)
- **HISTORY** (`two.tsx`): 부모님-자녀 간 **양방향 활동 로그** 타임라인 병합 및 사진/영상 구글 포토 스타일 카드 피드, 미디어 재생 지원, **기분(Mood) 이모지 표시**
  - **멤버십 기반 공유**: 가족 그룹 내 모든 보호자가 활동 내역을 공유 (`action_logs` 쿼리 및 RLS)
  - **리치 프로필**: 기록 작성자의 프로필 사진(아바타) 노출 지원
- **CARE** (`care.tsx`): 구글 애드몹 보상형 광고 시청 ➡️ 사진(`type=photo`)/동영상(`type=video`)/음성(`type=voice_cheer`) 통합 미디어 무제한 마음 전송

### 👤 보조 보호자 (Secondary Guardian)

- 초대 코드로 가족 그룹 합류 (가입 시 또는 기존 계정에서 추가 가능)
- 주 보호자와 동일한 안부 피드 확인 및 양방향 소통

---

## 5. 데이터베이스 스키마

| 테이블 | 역할 |
|--------|------|
| `profiles` | 사용자 정보 (이름, 역할, 이메일) |
| `family_groups` | 가족 그룹 단위 |
| `family_members` | 그룹 내 구성원 매핑 |
| `action_logs` | 활동 로그 (기상, 미디어, 메시지). type: `check_in`, `voice_cheer`, `message`, `photo`, `video` |
| `daily_status` | 부모님 일일 상태 (기분/mood) |
| `parent_invitations` | 부모님 초대 코드 |
| `guardian_invitations` | 보조 보호자 초대 코드 |

---

## 6. 디자인 시스템 (Design System)

**컨셉: "Soft UI & Warmth"**

| 토큰 | 값 | 용도 |
|------|-----|------|
| Primary | Deep Green | 신뢰감 |
| Background | Warm Ivory `#F5F5F0` | 차분한 배경 |
| Action | Deep Blue / Forest Green | CTA 버튼 |
| 모서리 | Rounded-xl | 부드러운 카드 |
| 그림자 | Neumorphism | 깊이감 |

---

## 7. 핵심 개발 규칙

### 코드 컨벤션

1. **언어**: TypeScript 필수, `any` 타입 사용 금지
2. **스타일**: `StyleSheet.create()` 사용, 인라인 스타일 최소화
3. **상태**: 전역 상태는 Zustand, 로컬 상태는 `useState`
4. **문구**: 모든 UI 문구는 `constants/strings.ts`에서 상수로 관리
5. **컬러**: 직접 색상값 사용 금지, `Colors.ts` / `theme.ts`에서 참조
6. **웹 호환성**: `expo-haptics` 등 네이티브 전용 기능 호출 시 `Platform.OS !== 'web'` 가드 필수 적용

### UX 원칙

1. **Zero UI**: 1초 만에 상황 파악 가능해야 함
2. **불안감 금지**: 부정적 표현, 실패 표시 금지
3. **따뜻한 톤**: "전해졌어요", "충분해요" 등 긍정적 카피
4. **광고 리프레이밍**: 광고가 아닌 "선물 포장" 경험으로 전환

### 문구 사전 (Copywriting)

| 상황 | 문구 |
|------|------|
| 안부 대기 | "오늘 안부가 아직 없어요" |
| 안부 완료 | "오늘 안부가 전해졌어요" |
| 광고 버튼 | "광고 보고 전하기" |
| 로딩 중 | "안부를 준비 중이에요..." |
| 완료 | "전해졌어요. 따뜻한 마음이 닿았어요." |

---

## 8. 인증 시스템 (Hybrid Auth)

역할별로 인증 방식을 분리하는 하이브리드 구조:

| 역할 | 인증 방식 | 가입 플로우 |
|------|----------|-----------|
| **Guardian (주보호자)** | ✅ 이메일 OTP 인증 | 이메일+비밀번호 입력 → OTP 코드 이메일 수신 → 앱 내 입력 → 인증 완료 |
| **Parent (부모님)** | ❌ 인증 불필요 | 초대코드 입력 → 이름+간편비밀번호 설정 → 즉시 로그인 |
| **보조 Guardian** | ❌ 인증 불필요 | 초대코드 입력 → 이메일+비밀번호 설정 → 즉시 로그인 |

### 인증 플로우 다이어그램

```
[Guardian 가입]
  이메일/이름/비밀번호 입력 → OTP 코드 발송 → 앱 내 코드 입력 → 인증 완료 → 자동 로그인

[부모님 가입]
  초대코드 입력 → 코드 검증 → 이름/비밀번호 설정 → 즉시 로그인 → 부모님 화면

[보조 Guardian 가입]
  초대코드 입력 → 코드 검증 → **초대 부모님 정보 확인** → 이메일/비밀번호 설정 → 즉시 로그인 → 탭 홈
```

### Supabase 설정

- Dashboard: Authentication → Providers → Email → **"Confirm email" OFF**
- Guardian OTP 인증은 앱 코드에서 `verifyOtp(type: 'signup')` 호출로 구현

---

## 9. 참고 문서

| 문서 | 경로 | 내용 |
|------|------|------|
| 상세 구현 현황 | `zmd/Context.md` | 각 화면별 구현 상태, 기능 상세 |
| Supabase 정보 | `zmd/Supabase 정보.md` | DB 접속 정보 |
| 에이전트 규칙 | `.antigravityrules` | AI 응답 규칙 |
