# 2026-03-01 업데이트 일지

오늘(2026년 3월 1일)은 **ON-ANBU (온안부)** 앱의 사용성 향상을 위해 주로 **UI 구조 개선, 버그 수정 및 용어/명칭 통일 작업**을 진행했습니다.

## 1. 보호자(자녀) 메인 홈 화면 UI 개편

- **상단 레이아웃 압축 및 카드화**: 기존에 분리되어 공간을 많이 차지하던 '기상/기분 상태 문구'와 '꽃 이모지' 영역을 가로로 결합했습니다.
- **동적 배경색 카드 적용**: 결합된 영역을 둥근 모서리와 그림자가 있는 카드 형태로 만들고, 부모님의 **오늘 기분에 따라 카드 배경색이 동적으로 변하도록** 색상 맵킹을 적용했습니다.
  - *아주 좋아요*: 핑크/오렌지 빛(`bg-pink-50`)
  - *좋아요*: 연한 노랑/연두(`bg-yellow-50`)
  - *보통이에요*: 편안한 녹색(`bg-emerald-50`)
  - *피곤해요/아파요*: 차분한 보라/회색(`bg-purple-50`, `bg-slate-50`)
- 이를 통해 하단의 "오늘의 안부(히스토리 피드)"를 스크롤 없이 더 많이 볼 수 있게 되었습니다.

## 2. 부모님 기분 재선택 동기화 버그 수정

- **이슈**: 부모님 계정에서 오늘 기분을 선택한 뒤, 마음이 바뀌어 다른 기분을 다시 누르면 보호자 앱이나 DB에 반영(덮어쓰기)되지 않고 무시되는 현상 발견.
- **해결 (`app/parent/index.tsx`)**: 기존 `upsert` 로직에서 고유 복합키 처리가 미흡했던 부분을 보완하여, 저장 전 오늘 날짜의 데이터 존재 여부를 `select`로 먼저 확인하고 **있으면 `UPDATE`**, **없으면 `INSERT`** 하도록 분기 로직을 전면 수정했습니다.
- 이제 부모님 화면에서 언제든 기분을 변경해도 정상적으로 오늘 상태가 업데이트됩니다.

## 3. 앱 전반적인 호칭(용어) 개편 및 통일

- 앱의 본래 취지(부모님 외에도 배우자, 친척 등 다양한 대상 케어)에 맞게 **"부모님"이라는 고정된 단어를 "케어대상"으로 전면 교체**했습니다.
  
**[가족 관리 화면 (`app/family/index.tsx`)]**

- 리스트와 안내 문구의 "부모님"을 "케어대상"으로 변경.
- 하단에 있던 작은 텍스트 단축 링크(다른 부모님 초대)를 과감히 삭제하고, 보조 보호자 초대 버튼과 똑같은 둥근 라운드 디자인의 **[신규 케어대상 초대코드 생성하기]** 주황색 큰 버튼을 신설하여 시인성을 높였습니다.

**[초대 화면 (`invite-parent.tsx`, `invite-guardian.tsx`)]**

- '부모님을 초대하세요' ➡️ '케어대상을 초대하세요' 등으로 타이틀 및 안내, 카카오톡 공유 메시지 등 수정 완료.
- **관계 선택 폭 확장**: 기존 (어머니, 아버지, 형제 등) 관계에서 **아내, 아들, 딸, 친구, 동료, 기타** 항목을 추가하여 더 폭넓은 관계를 수용할 수 있게 되었습니다.

**[초기 역할 선택 화면 (`app/auth/role-select.tsx`)]**

- 가입/로그인 시 보여지는 "어떻게 오셨나요" 화면의 옵션 명칭을 명확하게 분리했습니다.
  - (부모님 케어) ➡️ **주 케어자로 시작할게요**
  - (자녀에게 초대) ➡️ **케어대상으로 초대받았어요**
  - (가족으로 초대) ➡️ **함께 케어할 보조 케어자예요**

# 오늘 작업된 안부/기록 기능 종합 요약 (2026-03-02)

1. 마음 전하기 화면(Care Screen) 개선
동적 호칭 적용: 딱딱한 "부모님"이라는 텍스트 대신, 앱에 연동된 케어대상의 실제 이름(parentName)이 UI 전반에 다정하게 필터링되어 출력되도록 개선했습니다.
맞춤형 안부 자동 문구 시스템 (300제):
가족 관계(mother, father, parents, spouse_children, default 등)에 따라 다정하고 따뜻한 안부 문구를 넉넉하게 무작위 제공하는 careMessages.json 로컬 데이터를 구축했습니다. (관계 세분화 적용 완료)
기존 수동 텍스트 입력창은 삭제되고, 대신 하단의 [다른 문구 보기] 새로고침 버튼을 눌러 언제든 마음에 드는 멘트가 뜰 때까지 슬롯머신처럼 메시지를 갱신할 수 있는 UI로 개편했습니다.
리워드 광고 15초를 시청한 후에는 해당 문구가 번거로운 조작 없이 즉시 안부 메시지 DB로 자동 전송됩니다.
2. 홈 화면 스크롤 사용성 통일
부모님(케어대상) 및 보호자 뷰 통합: 홈 화면 최상단의 프로필 영역이나 인사말 영역은 상단에 고정(flex)되게 하고, 하단의 오늘의 안부 리스트 영역만 스크롤 되도록 변경하여 정보 접근성을 대폭 개선했습니다.
3. 우리 가족 기록 화면(History Feed) 대대적 개편
새로고침 기능: 스크롤을 끌어내리지 않아도 우측 상단의 새로고침 아이콘 하나로 바로 최신 안부 내역을 갱신할 수 있습니다.
추억 모아보기(Play Movie) 모달 신규 도입:
리워드 광고 시청 후, 지금까지 가족들이 주고받은 안부와 사진, 영상, 음색 등을 연속해서 구글 포토 스토리처럼 모아보는 기능을 출시했습니다.
기존 기록 컴포넌트(
HistoryFeed.tsx
) 내부에서 재사용 가능하게 만들어 유지보수의 효율성을 높였습니다.
부모님(케어대상) 계정에서도 기존 전용 화면 대신 똑같은
HistoryFeed
 레이아웃을 사용하도록 뷰를 완벽히 통합하여, 부모님도 새로고침 및 모아보기를 동일하게 경험할 수 있습니다.
4. Play Movie 몰입 기능 고도화
풀스크린(전체화면) 재생 모드: 단순한 카드를 띄우는 것이 아니라, 화면을 까맣게 채운 뒤 사진과 영상이 꽉 차는 몰입형 레이아웃으로 변경했습니다. 상단에는 누가 언제 남긴 안부인지 아이콘 캡슐 디자인으로 띄워줍니다. 텍스트 안부는 하단에 감성적인 자막 형태로 표시됩니다.
BGM 무한 재생 및 스마트 간섭 방지:
추억 재생이 시작되면 마음이 따뜻해지는
bgm_Anbu.mp3
가 배경에 반복 재생됩니다.
시청 도중 동영상이 재생되거나, 부모님의 생생한 목소리가 담긴 '음성 메시지' 슬라이드로 넘어가면 배경음악이 자동으로 잠시 꺼졌다가 슬라이드가 넘어가면 다시 켜지는 스마트 미디어 간섭 방지 기술도 도입했습니다.
